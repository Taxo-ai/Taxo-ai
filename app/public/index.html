<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website</title>
    <link rel="stylesheet" href="./style.css">
    <script src="script.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/mhDoLbDldZc3qpsJHpLogda//BVZbgYuw6kof4u2FrCedxOtgRZDTHgHUhOCVim" crossorigin="anonymous"></script>
    <style>
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3rem;
        }
        </style>        
</head>
<body>
<!--
    ğŸ’¡IMPORTANT:  post url    :   "http://localhost/query?query=" with product name (pname)
                response is :   "type: 'è›‹ç³•ï¼ˆç³•ç‚¹ï¼‰', code: '1030201010000000000', rate: 'å¯¹åº”çš„ç¨ç‡'"
                                        Cake                Cake's taxID                tax rate
    ğŸ“”TODO:       
                1.We need a components to receive the response and visualize response data on the page 
                  (or create a new page used for visualize response data)
                2.The LLM is too slowlyï¼Œso we can not receive response immediately when we click the submit btn
                  So we need a load animation to dealing with this terrible user experience ğŸ˜

-->
    <header style="margin:1%;padding:1%;" >
        <nav class="navbar bg-transparent" >
            <div class="container">
                <a class="navbar-brand" href="#">
                    <img src="images/taxo.png" alt="Logo" width="100" height="75" class="d-inline-block align-text-top">
                </a>
                <a class="navbar-brand text-white text-poppins">TAXO AI</a>
            </div>
        </nav>
    </header>
    
    <main style="margin:3%;padding:3%;" class="mb-5">
        <div class="container-fluid content text-white">
            <h1>Automatic Tax Coding<br> System based on Large Language Models.</h1>
            <p>Elevate your potential with AI: where innovation meets intelligence. <br>    
            AI solutions tailored for your success.</p>
            <br/>
            <form id="myForm" class="row g-2">
                <div class="col-auto">
                    <!--parameter:pname (product name)-->
                    <input class="form-control form-control-lg" type="text" placeholder="Type Product Name" aria-label=".form-control-lg example" name="pname">
                </div>
                <div class="col-auto">
                    <button id="submitButton" type="submit" class="btn btn-primary btn-lg">Get TaxID</button>
                </div>
            </form>
            <!-- display response -->
            <div id="response" class="mt-5"></div>
        </div>
    </main>
    
    <footer class="footer fixed-bottom" style="background-color: black;">
        <div class="text-white container">
            <div class="row" >
                <div class="col-1">
                    <img src="images/taxo.png" alt="Logo" width="100" height="75" class="d-inline-block align-text-top">
                </div>
                <div class="col-8 mt-3" style="margin: 1%;">
                    <h5>Taxo.ai</h5>
                    <p>Project Source: <a href="https://github.com/Taxo-ai/Taxo-ai" class="text-white">https://github.com/Taxo-ai/Taxo-ai</a></p>
                    <h5>Team Taxo.ai:</h5>
                </div>
            </div>
        </div>
    </footer>

<script>
document.getElementById('myForm').addEventListener('submit', function(event) {
    event.preventDefault(); // é˜²æ­¢é»˜è®¤è¡¨å•æäº¤

    const productName = document.querySelector('input[name="pname"]').value;
    const url = `http://localhost:3000/query?query=${encodeURIComponent(productName)}`;

    // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    const responseDiv = document.getElementById('response');
    responseDiv.innerHTML = '<p>åŠ è½½ä¸­...</p>';
    const loadingAnimation = document.createElement('div');
    loadingAnimation.classList.add('spinner-border');
    loadingAnimation.setAttribute('role', 'status');
    const loadingText = document.createElement('span');
    loadingText.classList.add('visually-hidden');
    loadingText.textContent = 'åŠ è½½ä¸­...';
    loadingAnimation.appendChild(loadingText);
    responseDiv.appendChild(loadingAnimation);

    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`ç½‘ç»œå“åº”å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š${response.status}`);
            }
            return response.text(); // æ¥å—æ–‡æœ¬æ ¼å¼çš„å“åº”
        })
        .then(text => {
            // ç§»é™¤åŠ è½½åŠ¨ç”»
            responseDiv.innerHTML = '';
            // è°ƒè¯•æ—¥å¿—ï¼Œæ£€æŸ¥å“åº”çš„æ–‡æœ¬å†…å®¹
            console.log('å“åº”æ•°æ®:', text);

            // å°†æ–‡æœ¬è§£æä¸ºå¯¹è±¡
            const data = parseResponse(text);

            // å¤„ç†å¹¶æ˜¾ç¤ºå“åº”æ•°æ®
            if (data && data.type && data.code && data.rate) {
                responseDiv.innerHTML = `
                    <p>ç±»å‹: ${data.type}</p>
                    <p>ä»£ç : ${data.code}</p>
                    <p>ç¨ç‡: ${data.rate}</p>
                `;
            } else {
                responseDiv.innerHTML = '<p>æ— æ³•è·å–æœ‰æ•ˆçš„å“åº”æ•°æ®ï¼Œå¦ˆçš„ã€‚</p>';
                console.error('æ— æ•ˆçš„å“åº”æ•°æ®:', text);
            }
        })
        .catch(error => {
            // ç§»é™¤åŠ è½½åŠ¨ç”»
            responseDiv.innerHTML = '';
            // å¤„ç†é”™è¯¯
            responseDiv.innerHTML = `<p>å‘ç”Ÿé”™è¯¯ï¼Œå¦ˆçš„ï¼Œç¨åé‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š${error.message}</p>`;
            console.error('å‘ç”Ÿé”™è¯¯:', error);
        });
});

// è§£æå“åº”å­—ç¬¦ä¸²ä¸ºå¯¹è±¡
function parseResponse(response) {
    const regex = /type:\s*'([^']*)',\s*code:\s*'([^']*)'(?:,\s*rate:\s*'([^']*)')?/;
    const match = response.match(regex);
    if (match) {
        return {
            type: match[1],
            code: match[2],
            rate: match[3] || 'æœªæä¾›'
        };
    } else {
        return null;
    }
}

</script>
</body>
</html>
